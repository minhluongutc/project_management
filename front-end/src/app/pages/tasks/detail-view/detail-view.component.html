<div class="ml-4 mr-4">
  <div class="grid grid-cols-12 gap-4">
    <div class="col-span-3">
      <p-table [value]="listData"
               [paginator]="true"
               [rows]="rows">
        <ng-template pTemplate="header" let-columns>
          <tr class="text-sm">
            <th pSortableColumn="subject">Tiêu đề<p-sortIcon field="subject"></p-sortIcon></th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-item>
          <tr class="h-[48px]" (click)="viewDetail(item)">
            <td class="text-sm">{{ item.subject }}<br/>{{item.taskCode}}</td>
          </tr>
        </ng-template>
      </p-table>
    </div>
    @if (taskSelected) {
      <div class="col-span-5">
        <p class="text-base pb-2"><strong>{{taskSelected?.projectName}}</strong> / {{taskSelected?.taskCode}}</p>
        <h3 class="text-2xl pb-3">{{taskSelected.subject}}</h3>
        <div class="flex gap-2 pb-3">
          <p-button label="Chỉnh sửa"
                    [text]="true"
                    [plain]="true"
                    size="small"
                    class="import-button font-light"
                    [styleClass]="'h-[32px]'"
                    icon="pi pi-pencil"
                    (onClick)="showEditTask()"
          />
          <p-button label="Tạo dự án con"
                    [text]="true"
                    [plain]="true"
                    size="small"
                    class="import-button font-light"
                    [styleClass]="'h-[32px]'"
                    icon="pi pi-plus"
          />
        </div>
        <p class="text-base">Mô tả</p>
        <div [innerHTML]="taskSelected?.description"></div>
        <p class="text-base mt-4">Tệp định kèm</p>
        @if (attachments.length == 0) {
          <p class="text-base">N/A</p>
        } @else {
          @for (attachment of attachments; track $index) {
            <a class="text-blue-700 cursor-pointer" (click)="downloadAttachment(attachment)">{{attachment.fileName}}</a>
            <br/>
          }
        }
        <div class="pt-4">
          <p-tabView styleClass="tabview-custom">
            <p-tabPanel>
              <ng-template pTemplate="header">
                <div class="flex gap-2">
                  <i class="pi pi-comments"></i>
                  <span>Bình luận</span>
                </div>
              </ng-template>
              <div class="flex gap-3">
                <p-avatar image="https://primefaces.org/cdn/primeng/images/demo/avatar/amyelsner.png" styleClass="mr-2" size="xlarge" shape="circle" [style]="{'padding': '0'}"></p-avatar>
                <p-chips ></p-chips>

              </div>
            </p-tabPanel>
            <p-tabPanel header="Header II">
              <ng-template pTemplate="header">
                <div class="flex gap-2">
                  <i class="pi pi-history"></i>
                  <span>Lịch sử sửa đổi</span>
                </div>
              </ng-template>
              <p>
                Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo. Nemo enim
                ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos qui ratione voluptatem sequi nesciunt. Consectetur, adipisci velit, sed quia non numquam eius modi.
              </p>
            </p-tabPanel>
          </p-tabView>
        </div>
      </div>
      <div class="col-span-4 flex flex-col gap-4">
        <p-button [text]="true"
                  [plain]="true"
                  size="small"
                  class="import-button font-light"
                  [styleClass]="'h-[32px]'"
                  icon="pi pi-angle-down"
                  iconPos="right"
                  [label]="taskSelected.statusIssueName"
        />
        <p-accordion [multiple]="true" [activeIndex]="[0]">
          <div class="col-start-1 col-end-2"></div>
          <p-accordionTab header="Chi tiết" [headerStyleClass]="'bg-white p-3 text-sm border-solid border-t-2-primary'">
            <div class="grid grid-cols-2 gap-4">
              <div class="col-span-1">
                <p class="text-base">Danh mục</p>
                <p class="text-base">Người tạo</p>
                <p class="text-base">Người thực hiện</p>
                <p class="text-base">Ngày bắt đầu</p>
                <p class="text-base">Ngày kết thúc</p>
                <p class="text-base">Ưu tiên</p>
                <p class="text-base">Mức độ</p>
                <p class="text-base">Loại công việc</p>
                <p class="text-base">Người nghiệm thu</p>
                <p class="text-base">Parent</p>
              </div>
              <div class="col-span-1">
                <p class="text-base">{{taskSelected.categoryName}}</p>
                <p class="text-base">{{taskSelected.createUserName}}</p>
                <p class="text-base">{{taskSelected.assignUserName}}</p>
                <p class="text-base">{{taskSelected.startDate | date: 'dd/MM/yyyy'}}</p>
                <p class="text-base">{{taskSelected.dueDate | date: 'dd/MM/yyyy'}}</p>
                <p class="text-base">{{convertValueById(taskSelected.priority, 'name', PRIORIES)}}</p>
                <p class="text-base">{{convertValueById(taskSelected.severity, 'name', SEVERITIES)}}</p>
                <p class="text-base">{{taskSelected.typeName}}</p>
                <p class="text-base">{{taskSelected.reviewUserName}}</p>
                @if (taskSelected.projectParentSubject!='N/A') {
                  <a class="text-base text-blue-700 cursor-pointer"
                     [routerLink]="'.'"
                     [queryParams]="{taskCode: taskSelected.projectParentTaskCode}">
                    {{taskSelected.projectParentSubject}}
                  </a>
                }@else {
                  <p class="text-base">{{taskSelected.projectParentSubject}}</p>
                }
              </div>
            </div>
          </p-accordionTab>
        </p-accordion>
        <p-accordion [multiple]="true" [activeIndex]="[0]">
          <div class="col-start-1 col-end-2"></div>
          <p-accordionTab header="Children tasks" [headerStyleClass]="'bg-white p-3 text-sm border-solid border-t-2-primary'">
            <div class="grid grid-cols-2 gap-4">
              main content
            </div>
          </p-accordionTab>
        </p-accordion>
      </div>
    }
  </div>
</div>
